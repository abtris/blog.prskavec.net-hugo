<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
  
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  

  
  <title>Jenkins 2.0 - novinky a vylepšení</title>

  
  
  <link rel="stylesheet" href="https://blog.prskavec.net/css/hugo-octopress.css">

  
  

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

  
  <link href="https://blog.prskavec.net/favicon.png" rel="icon">

  
  
  

  

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="author" content="Author&#39;s name">

  
  <meta name="generator" content="Hugo 0.27" />

  
  

</head>
<body>


<header role="banner"><hgroup>
  
  <h1><a href="https://blog.prskavec.net/">Prskavčí blog</a></h1>
    <h2>Subtitle appears under website title</h2>
</hgroup></header>


<nav role="navigation">

<ul class="main-navigation">
  
  
    
      <li><a href="https://blog.prskavec.net/" title="Blog">Blog</a></li>
    
  
    
      <li><a href="https://www.google.com/" title="Google"  target="_blank" >Google</a></li>
    
  
    
      <li><a href="https://www.github.com/parsiya/hugo-octopress" title="This theme on Github"  target="_blank" >This theme on Github</a></li>
    
  
</ul>


<ul class="subscription">
  
    
        <a href="https://blog.prskavec.net/index.xml" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a>
    
  

</ul>


<form action="https://www.google.com/search" method="get" target="_blank">
  <fieldset role="search">
  	<input class="search" type="text" name="q" results="0" placeholder="Search"/>
    <input type="hidden" name="q" value="site:https://blog.prskavec.net/" />
  </fieldset>
</form>

</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
    <p class="meta">Oct 26, 2016
         - 3 minute read 
         - <a href="https://blog.prskavec.net/2016/10/26/jenkins-2-dot-0-novinky-a-vylepseni/#disqus_thread">Comments</a>

        
        
        
            - <a class="label" href="https://blog.prskavec.net/categories/jenkins/">jenkins </a>
        
    </p>
    <h1 class="entry-title">
         Jenkins 2.0 - novinky a vylepšení 
    </h1>
</header>


        <div class="entry-content">
          
          
          
          
          <p>Jenkins je nejznámější řešení na Continues Integration, který existuje už řadu let. Od září je venku konečně verze 2.x (aktuálně 2.19.1 LTS), která obsahuje několik zásadních novinek.</p>

<p>Jenkins používám řadu let a také ho <a href="/skoleni-a-kurzy/">školím ve firmách</a> co chtějí toto řešení nasadit. Před 2 lety jsem si řekl, že není Jenkins moc dobrá cesta. Žádné použitelné novinky se dlouho neobjevovali a vůbec se nezlepšovalo použití pro větší nasazení Jenkinusů ve firmách.</p>

<p></p>

<p>Já mám na každé CI tento seznam požadavků:</p>

<ul>
<li>job definitions in repository</li>
<li>autoscaling on traffic with lowest possible price</li>
<li>pipelines / workflow</li>
<li>solution for caching for installations</li>
<li>docker support</li>
<li>matrix builds</li>
<li>distributed job across multiple nodes</li>
</ul>

<p>a hned ten nejzásadnější právě dlouho Jenkins nesplňoval. Od verze 2.0 je mezi základními rozšířeními podpora pro Continues Delivery Pipelines (dále jen pipelines), které jdou psát do souboru jako <code>Jenkinsfile</code>, který můžete mít s projektem v repozitáři a Jenkins umí spolupracovat s SCM například s Github, kde mu stačí dát jméno organizace nebo uživatele a on proskenuje vaše repositáře a tam kde najde <code>Jenkinsfile</code> pro ty repositáře vytvoří úlohy ke zpracování.</p>

<p>Ukázka jak takový soubor s pipelines vypadá pro malý projekt.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #93A1A1">node</span> <span style="color: #719e07">{</span>
   <span style="color: #93A1A1">stage</span><span style="color: #719e07">(</span><span style="color: #2AA198">&#39;Preparation&#39;</span><span style="color: #719e07">)</span> <span style="color: #719e07">{</span>
      <span style="color: #93A1A1">git</span> <span style="color: #2AA198">&#39;https://github.com/abtris/bee.git&#39;</span>
   <span style="color: #719e07">}</span>
   <span style="color: #93A1A1">stage</span><span style="color: #719e07">(</span><span style="color: #2AA198">&#39;Deps&#39;</span><span style="color: #719e07">)</span> <span style="color: #719e07">{</span>
       <span style="color: #93A1A1">env</span><span style="color: #719e07">.</span><span style="color: #93A1A1">PACKAGE</span><span style="color: #719e07">=</span><span style="color: #2AA198">&quot;github.com/abtris/bee&quot;</span>
       <span style="color: #93A1A1">env</span><span style="color: #719e07">.</span><span style="color: #93A1A1">GOPATH</span><span style="color: #719e07">=</span><span style="color: #2AA198">&quot;~/go&quot;</span>
       <span style="color: #93A1A1">env</span><span style="color: #719e07">.</span><span style="color: #93A1A1">GOROOT</span><span style="color: #719e07">=</span><span style="color: #2AA198">&quot;/usr/local/opt/go/libexec&quot;</span>
       <span style="color: #93A1A1">sh</span> <span style="color: #2AA198">&#39;glide --no-color install&#39;</span>
       <span style="color: #93A1A1">sh</span> <span style="color: #2AA198">&#39;mkdir -p release&#39;</span>
   <span style="color: #719e07">}</span>
   <span style="color: #93A1A1">stage</span><span style="color: #719e07">(</span><span style="color: #2AA198">&#39;Test&#39;</span><span style="color: #719e07">)</span> <span style="color: #719e07">{</span>
       <span style="color: #93A1A1">sh</span> <span style="color: #2AA198">&#39;make xunit&#39;</span>
   <span style="color: #719e07">}</span>
   <span style="color: #93A1A1">stage</span><span style="color: #719e07">(</span><span style="color: #2AA198">&#39;Build&#39;</span><span style="color: #719e07">)</span> <span style="color: #719e07">{</span>
         <span style="color: #93A1A1">parallel</span> <span style="color: #719e07">(</span>
            <span style="color: #93A1A1">linux64:</span> <span style="color: #719e07">{</span> <span style="color: #93A1A1">sh</span> <span style="color: #2AA198">&quot;goos=linux goarch=amd64 make build&quot;</span> <span style="color: #719e07">},</span>
            <span style="color: #93A1A1">linux32:</span> <span style="color: #719e07">{</span> <span style="color: #93A1A1">sh</span> <span style="color: #2AA198">&quot;goos=linux goarch=386 make build&quot;</span> <span style="color: #719e07">},</span>
            <span style="color: #93A1A1">mac64:</span> <span style="color: #719e07">{</span> <span style="color: #93A1A1">sh</span> <span style="color: #2AA198">&quot;goos=darwin goarch=amd64 make build&quot;</span> <span style="color: #719e07">},</span>
            <span style="color: #93A1A1">win64:</span> <span style="color: #719e07">{</span> <span style="color: #93A1A1">sh</span> <span style="color: #2AA198">&quot;goos=windows goarch=amd64 make build&quot;</span> <span style="color: #719e07">}</span>
          <span style="color: #719e07">)</span>
   <span style="color: #719e07">}</span>
   <span style="color: #93A1A1">stage</span><span style="color: #719e07">(</span><span style="color: #2AA198">&#39;Results&#39;</span><span style="color: #719e07">)</span> <span style="color: #719e07">{</span>
      <span style="color: #93A1A1">archive</span> <span style="color: #2AA198">&#39;release/*&#39;</span>
      <span style="color: #93A1A1">junit</span> <span style="color: #2AA198">&#39;tests.xml&#39;</span>
   <span style="color: #719e07">}</span>
<span style="color: #719e07">}</span>
</pre></div>

<p>Jenkinsfile je <a href="https://en.wikipedia.org/wiki/Domain-specific_language" target="_blank">DSL</a> v programovacím jazyku <a href="http://www.groovy-lang.org" target="_blank">Groovy</a> obsahuje blok s názvem <code>node</code> kde si definujete, kde a co se má co spouštět. V ukázce tam není žádná podmínka a tak Jenkins rozhodně sám kde to spustí. Pokud by jste to chtěli upřesnit tak se dá se specifikovat zda to má být master nebo naopak, že to nemá být master (doporučeno) a také jde přímo označit agenta (slave), kterého máte připojeného k Jenkins masteru. Může to být instance na Amazon Web Services (AWS) nebo v jiném cloudu, tak jakýkoliv jiný počítač, který si k tomu určíte a pustíte na něm potřebného klienta.</p>

<p>Další klíčovým slovem je <code>stage</code>, kde si názvem rozdělíme pipeline do nějakých logických celků. Tyto části, pokud to má smysl, můžeme zpracovávat paralelně jako je to v ukázce v části <code>Build</code>. Využití paralelního zpracování je tam, kde chcete zkrátit čas celého build a pokud na to máte volné prostředky (agenty).</p>

<p>Vše spouštím pomocí linuxového shellu pomocí klíčového slova <code>sh</code>. Mohl bych testovat pomocí <code>isUnix()</code> zda jsme na stroji, který toho je vůbec schopen, to vám pomůže pokud používáte různé stroje, některé s Windows a jiné s Linuxem.</p>

<p>V poslední části <code>Results</code> archivujeme artefakty (tady binárné soubory) vytvořené při buildu a výsledky testů z kroku <code>Test</code>.</p>

<p>To je vše a v Jenkinsu to potom vypadá takto:</p>

<p><img src="/images/jenkins/pipelines-parallel.png" alt="" /></p>

<p>Takto se pipelines zobrazují v novém UI BlueOcean.</p>

<p>Pipelines mají před sebou velkou budoucnost, připravují se vylepšení v podobě online editoru a více deklarativního zápisu než dnes.</p>

<p>Dalším požadavkům, které mám na CIE se budu věnovat zase v dalším příspěvku.</p>
        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">Author&#39;s name</span></span>
    
    <time>Oct 26, 2016</time>
    
    </span>
  </p>

  
  

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://blog.prskavec.net/2016/10/17/prednaska-o-sre-na-devops-meetupu/" title="Přednáška o SRE na DevOPS meetupu">Přednáška o SRE na DevOPS meetupu</a>
    

    
      <a class="basic-alignment right" href="https://blog.prskavec.net/2016/10/31/jenkins-2-dot-0-novinky-a-vylepseni-2-dot-cast/" title="Jenkins 2.0 - novinky a vylepšení - 2.část">Jenkins 2.0 - novinky a vylepšení - 2.část</a>
    
  </p>
  
    
      <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'prskavecblog';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    
      <h1>Sidebar Header</h1>
    

    <p>
      
        Here&rsquo;s a <a href="https://www.google.com" target="_blank">link to google</a>
  </br>
  Second line
  </br>
  Third line
  This line has two spaces in the end to create a new line using markdown
  Forth line
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/abtris/" title="https://github.com/abtris/"><i class="fa fa-github fa-3x"></i></a>
      <a target="_blank" href="https://bitbucket.org/abtris/" title="https://bitbucket.org/abtris/"><i class="fa fa-bitbucket fa-3x"></i></a>
      
      <a target="_blank" href="https://twitter.com/abtris/" title="https://twitter.com/abtris/"><i class="fa fa-twitter fa-3x"></i></a>
      <a target="_blank" href="https://keybase.io/abtris/" title="https://keybase.io/abtris/"><i class="fa fa-key fa-3x"></i></a> 
      
      
      
      
      
      

    
    
    </li>
  </ul>

  

  
    
      <section class="odd">
        
          <h1>Sidebar Links</h1>
        
        
          <li>
            <a href="https://blog.prskavec.net/categories/hugo/" title="Hugo" >Hugo</a>
          </li>
        
          <li>
            <a href="https://blog.prskavec.net/" title="Homepage" >Homepage</a>
          </li>
        
          <li>
            <a href="https://www.google.com" title="Google" >Google</a>
          </li>
        
      </section>
    
  

  
  
  
    
      <section class="even">
        <h1>Recent Posts</h1>
        <ul id="recent_posts">
          
            <li class="post">
              <a href="/2017/06/28/jam-stack/">JAM stack</a>
            </li>
          
            <li class="post">
              <a href="/2017/04/21/docker-multi-stage-build/">Docker - multi stage build</a>
            </li>
          
            <li class="post">
              <a href="/2016/12/20/jenkins-declarative-pipelines/">Jenkins Declarative Pipelines</a>
            </li>
          
            <li class="post">
              <a href="/2016/10/31/jenkins-2-dot-0-novinky-a-vylepseni-2-dot-cast/">Jenkins 2.0 - novinky a vylepšení - 2.část</a>
            </li>
          
            <li class="post">
              <a href="/2016/10/26/jenkins-2-dot-0-novinky-a-vylepseni/">Jenkins 2.0 - novinky a vylepšení</a>
            </li>
          
        </ul>
      </section>
    
  

</aside>

  </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2017 Author&#39;s name - <a href="https://blog.prskavec.net/license/">License</a> -
  <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
</p>

</footer>


</body>
</html>

