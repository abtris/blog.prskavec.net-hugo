<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
  
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  

  
  <title>Vytváření vývojového Virtuálního prostředí pomocí VirtualBoxu a Vagrantu</title>

  
  
  <link rel="stylesheet" href="https://blog.prskavec.net/css/hugo-octopress.css">

  
  

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

  
  <link href="https://blog.prskavec.net/favicon.png" rel="icon">

  
  
  

  

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="author" content="Author&#39;s name">

  
  <meta name="generator" content="Hugo 0.27" />

  
  

</head>
<body>


<header role="banner"><hgroup>
  
  <h1><a href="https://blog.prskavec.net/">Prskavčí blog</a></h1>
    <h2>Subtitle appears under website title</h2>
</hgroup></header>


<nav role="navigation">

<ul class="main-navigation">
  
  
    
      <li><a href="https://blog.prskavec.net/" title="Blog">Blog</a></li>
    
  
    
      <li><a href="https://www.google.com/" title="Google"  target="_blank" >Google</a></li>
    
  
    
      <li><a href="https://www.github.com/parsiya/hugo-octopress" title="This theme on Github"  target="_blank" >This theme on Github</a></li>
    
  
</ul>


<ul class="subscription">
  
    
        <a href="https://blog.prskavec.net/index.xml" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a>
    
  

</ul>


<form action="https://www.google.com/search" method="get" target="_blank">
  <fieldset role="search">
  	<input class="search" type="text" name="q" results="0" placeholder="Search"/>
    <input type="hidden" name="q" value="site:https://blog.prskavec.net/" />
  </fieldset>
</form>

</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
    <p class="meta">Feb 2, 2011
         - 4 minute read 
         - <a href="https://blog.prskavec.net/2011/02/02/vytvareni-vyvojoveho-virtualniho-prostredi-s-pomoci-virtualboxu-a-vagrantu/#disqus_thread">Comments</a>

        
    </p>
    <h1 class="entry-title">
         Vytváření vývojového Virtuálního prostředí pomocí VirtualBoxu a Vagrantu 
    </h1>
</header>


        <div class="entry-content">
          
          
          
          
          <p><a href="http://www.virtualbox.org/">Oracle VirtualBox</a> je známé virtualizační prostředí pro platformy linux, mac a windows. Já VirtualBox používám na linux, mám na něm Ubuntu, které používám na školení Subversion nebo na vývoj webových aplikací jako server. Do nedávna jsem to používal na Macu nebo Linux pro běh Windows apod. O tomto používání nechci dnes mluvit.</p>

<p><a href="http://www.vagrantup.com">Vagrant</a> je nástroj napsaný v Ruby, který nám umožňuje modifikovat virtualní stroj podle našich představ pomocí nějakého předpisu, který nám udělá co chceme. Ukážeme si to na příkladu, že připravím linuxový server pro webový vývoj s Apache, PHP5, MySQL, CouchDB.</p>

<p>Začneme instalací Vagrantu
<pre class="code">sudo gem install vagrant
vagrant box add base <a href="http://files.vagrantup.com/lucid32.box" target="_blank">http://files.vagrantup.com/lucid32.box</a></pre>
Vytvoříme si ukázkový projekt.
<pre class="code">mkdir vagrant-lamp
cd vagrant-lamp
vagrant init</pre>
Musíme upravit Vagrantfile podle následujícího předpisu (pro Vagrant 0.7).
<pre class="code">Vagrant::Config.run do |config|
  # All Vagrant configuration is done here. For a detailed explanation
  # and listing of configuration options, please view the documentation
  # online.</p>

<p># Every Vagrant virtual environment requires a box to build off of.
  config.vm.box = &ldquo;base&rdquo;</p>

<p>config.vm.forward_port(&ldquo;http&rdquo;, 80, 8080)
  config.vm.forward_port(&ldquo;mysql&rdquo;, 3306, 3306)
  config.vm.forward_port(&ldquo;couchdb&rdquo;, 5984, 5984)</p>

<p>config.vm.provision :chef_solo do |chef|
     chef.cookbooks_path = &ldquo;cookbooks&rdquo;
     chef.json.merge!({
        :mysql =&gt; {
            :server_root_password =&gt; &ldquo;root&rdquo;
        }
     })
     chef.add_recipe(&ldquo;vagrant_main&rdquo;)
  end</p>

<p>end</pre>
Vytvoříme si adresáře pro recepty a pro web.
<pre class="code">mkdir cookbooks
mkdir public</pre>
Do cookbooks je potřeba nakopírovat recepty pro Chef. Doporučuji si vzít z Githubu celou cookbooks repository.
git clone <a href="https://github.com/opscode/cookbooks.git">https://github.com/opscode/cookbooks.git</a></p>

<p>protože receptů je hodně, doporučuji si to dám někam mimo a nakopírovat jen potřebné recepty. Pro nás jsou to ty, které jsou v úvodu default.rb a některé navíc jako je třeba erlang pro couchdb.</p>

<p>do adresáře cookbooks jsem si nakopíroval tyto recepty z cookbooks repository.
<pre>apache2
apt
couchdb
erlang
git
mysql
openssl
php</pre>
Potom si vytvoříme vlastní recept, který celou akci <a href="http://www.opscode.com/chef">Chefa</a> v Vagrantu bude řídit.
<pre>mkdir -p cookbooks/vagrant_main/recipes
vim default.rb</pre>
Přidáme potřebné recepty
<pre>require_recipe &ldquo;apt&rdquo;
require_recipe &ldquo;apache2&rdquo;
require_recipe &ldquo;mysql::server&rdquo;
require_recipe &ldquo;php::php5&rdquo;
require_recipe &ldquo;git&rdquo;
require_recipe &ldquo;couchdb&rdquo;</pre>
Kromě instalace z receptů provede instalaci některý dalších balíčků v Ubuntu
<pre># Some neat package (subversion is needed for &ldquo;subversion&rdquo; chef ressource)
%w{ debconf php5-xdebug subversion mc htop curl }.each do |a_package|
  package a_package
end</pre>
Vytvoříme si testovací vývojový web.
<pre>s = &ldquo;dev-site&rdquo;
site = {
  :name =&gt; s,
  :host =&gt; &ldquo;www.#{s}.com&rdquo;,
  :aliases =&gt; [&ldquo;#{s}.com&rdquo;, &ldquo;dev.#{s}-static.com&rdquo;]
}</pre>
použije se template uložena v vagrant_main/templates/default/sites.conf.erb a příslušné proměnné
<pre># Configure the development site
web_app site[:name] do
  template &ldquo;sites.conf.erb&rdquo;
  server_name site[:host]
  server_aliases site[:aliases]
  docroot &ldquo;/vagrant/public/&rdquo;
end</pre>
modifikujeme si hosty
<pre># Add site info in /etc/hosts
bash &ldquo;info_in_etc_hosts&rdquo; do
  code &ldquo;echo 127.0.0.1 #{site[:host]} #{site[:aliases]} &gt;&gt; /etc/hosts&rdquo;
end</pre>
přidáme některé knihovny přímo z repository Subversion
<pre># Retrieve webgrind for xdebug trace analysis
subversion &ldquo;Webgrind&rdquo; do
  repository &ldquo;<a href="http://webgrind.googlecode.com/svn/trunk/&quot;" target="_blank">http://webgrind.googlecode.com/svn/trunk/&quot;</a>
  revision &ldquo;HEAD&rdquo;
  destination &ldquo;/var/www/webgrind&rdquo;
  action :sync
end</pre>
nebo Git
<pre># Retrieve adminer
git &ldquo;Adminer&rdquo; do
  repository &ldquo;<a href="https://github.com/vrana/adminer.git&quot;" target="_blank">https://github.com/vrana/adminer.git&quot;</a>
  revision &ldquo;HEAD&rdquo;
  destination &ldquo;/var/www/adminer/&rdquo;
  action :sync
end</pre>
a další
<pre># Latest Zend Framework version
subversion &ldquo;Zend&rdquo; do
  # repository &ldquo;<a href="http://framework.zend.com/svn/framework/standard/trunk/library/&quot;" target="_blank">http://framework.zend.com/svn/framework/standard/trunk/library/&quot;</a>
  repository &ldquo;<a href="http://framework.zend.com/svn/framework/standard/tags/release-1.11.3/library/&quot;" target="_blank">http://framework.zend.com/svn/framework/standard/tags/release-1.11.3/library/&quot;</a>
  revision &ldquo;HEAD&rdquo;
  destination &ldquo;/srv/lib/php/&rdquo;
  action :sync
end</pre>
Potom je tu script, kterým se dá modifikovat práva pro MySQL, není problém si podobně udělat jakékoliv úpravy.
<pre># Add an admin user to mysql
execute &ldquo;add-admin-user&rdquo; do
  command &ldquo;/usr/bin/mysql -u root -p#{node[:mysql][:server_root_password]} -e \&ldquo;&rdquo; +
      &ldquo;CREATE USER &lsquo;myadmin&rsquo;@&lsquo;localhost&rsquo; IDENTIFIED BY &lsquo;myadmin&rsquo;;&rdquo; +
      &ldquo;GRANT ALL PRIVILEGES ON <em>.</em> TO &lsquo;myadmin&rsquo;@&lsquo;localhost&rsquo; WITH GRANT OPTION;&rdquo; +
      &ldquo;CREATE USER &lsquo;myadmin&rsquo;@&lsquo;%&rsquo; IDENTIFIED BY &lsquo;myadmin&rsquo;;&rdquo; +
      &ldquo;GRANT ALL PRIVILEGES ON <em>.</em> TO &lsquo;myadmin&rsquo;@&lsquo;%&rsquo; WITH GRANT OPTION;\&rdquo; &ldquo; +
      &ldquo;mysql&rdquo;
  action :run
  ignore_failure true
end</pre>
pro funkční port forwarding u CouchDb modifikovat konfiguraci a potřeba dát po prvním spuštění dát vargant reload aby se tato poslední změna promítla do nastavení virtuálu.
<pre># Replace 127.0.0.1 bind port with 0.0.0.0 is necessary for port forwarding
execute &ldquo;port-forward-couchdb&rdquo; do
  command &ldquo;sudo sed -i &rsquo;s/127.0.0.1/0.0.0.0/g&rsquo; /etc/couchdb/default.ini&rdquo;
  action :run
end</pre>
První spuštění pomocí
<pre>vagrant up</pre>
potom je potřeba pro CouchDb
<pre>vagrant reload</pre>
Kompletní repositář s tímto ukázkovým prostředím jsou dostupné na <a href="https://github.com/abtris/vagrant-lamp">Githubu</a>.</p>

<p>Pokud si rozbijete virtuál tak není problém začít znovu. Dáte <code>vagrant destroy</code> a potom znovu pustíte celý proces pomocí <code>vagrant up</code>.</p>

<p>Pokud se chcete přihlásit na virtuál použijte <code>vagrant ssh</code>.</p>

        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">Author&#39;s name</span></span>
    
    <time>Feb 2, 2011</time>
    
      <span class="categories">
        Tags:
        
          <a class="category" href="https://blog.prskavec.net/tags/virtualizace">virtualizace</a>  
    
    </span>
  </p>

  
  

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://blog.prskavec.net/2011/01/28/zend-framework-a-nosql-pro-ukladani-logu-ve-webovych-aplikaci-druhy-dil-o-mongodb/" title="Zend Framework a NoSQL pro ukládání logů ve webových aplikací, díl druhý o MongoDb">Zend Framework a NoSQL pro ukládání logů ve webových aplikací, díl druhý o MongoDb</a>
    

    
      <a class="basic-alignment right" href="https://blog.prskavec.net/2011/02/14/phpstorm-2-0/" title="PHPStorm 2.0 - nová verze multiplatformního vývojového prostředí">PHPStorm 2.0 - nová verze multiplatformního vývojového prostředí</a>
    
  </p>
  
    
      <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'prskavecblog';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    
      <h1>Sidebar Header</h1>
    

    <p>
      
        Here&rsquo;s a <a href="https://www.google.com" target="_blank">link to google</a>
  </br>
  Second line
  </br>
  Third line
  This line has two spaces in the end to create a new line using markdown
  Forth line
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/abtris/" title="https://github.com/abtris/"><i class="fa fa-github fa-3x"></i></a>
      <a target="_blank" href="https://bitbucket.org/abtris/" title="https://bitbucket.org/abtris/"><i class="fa fa-bitbucket fa-3x"></i></a>
      
      <a target="_blank" href="https://twitter.com/abtris/" title="https://twitter.com/abtris/"><i class="fa fa-twitter fa-3x"></i></a>
      <a target="_blank" href="https://keybase.io/abtris/" title="https://keybase.io/abtris/"><i class="fa fa-key fa-3x"></i></a> 
      
      
      
      
      
      

    
    
    </li>
  </ul>

  

  
    
      <section class="odd">
        
          <h1>Sidebar Links</h1>
        
        
          <li>
            <a href="https://blog.prskavec.net/categories/hugo/" title="Hugo" >Hugo</a>
          </li>
        
          <li>
            <a href="https://blog.prskavec.net/" title="Homepage" >Homepage</a>
          </li>
        
          <li>
            <a href="https://www.google.com" title="Google" >Google</a>
          </li>
        
      </section>
    
  

  
  
  
    
      <section class="even">
        <h1>Recent Posts</h1>
        <ul id="recent_posts">
          
            <li class="post">
              <a href="/2017/06/28/jam-stack/">JAM stack</a>
            </li>
          
            <li class="post">
              <a href="/2017/04/21/docker-multi-stage-build/">Docker - multi stage build</a>
            </li>
          
            <li class="post">
              <a href="/2016/12/20/jenkins-declarative-pipelines/">Jenkins Declarative Pipelines</a>
            </li>
          
            <li class="post">
              <a href="/2016/10/31/jenkins-2-dot-0-novinky-a-vylepseni-2-dot-cast/">Jenkins 2.0 - novinky a vylepšení - 2.část</a>
            </li>
          
            <li class="post">
              <a href="/2016/10/26/jenkins-2-dot-0-novinky-a-vylepseni/">Jenkins 2.0 - novinky a vylepšení</a>
            </li>
          
        </ul>
      </section>
    
  

</aside>

  </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2017 Author&#39;s name - <a href="https://blog.prskavec.net/license/">License</a> -
  <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
</p>

</footer>


</body>
</html>

